# Prohousing server documentation 

 
## The server 

The server is an Ubuntu 18.04 LTS server running on the network in the ND Design Norway office. Christin or any other employee at the office should have physical access to the server if needed. Ubuntu 18.04 is officially supported by Canonical until April 2023. 

## Monitoring 

Netdata runs on the server and monitors almost every system vital imaginable. This can be accessed through: https://intern.prohousing.no/netdata If this is not running it is most likely either an issue with the machine itself or the Apache config. Locally on the machine this runs through and SystemD job on port 19999 and is forwarded by Apache to the address above 
 
For more info about Netdata look at the official documentation of the project here: 
https://github.com/firehol/netdata/wiki 

## SSH/Remote control 

To connect to the server, use SSH. SSH is configured to not allow password authentication. An authorized SSH key and its passphrase can be found in Bubble under the project: Fagprove Vetle.  
 
The password for the root user can also be found in Bubble

## Hardrives and Volumes 

The server has 2 hard drives. The main hard drive is a 250 GB Samsung SSD, this disk contains the OS, Programs, Databases and everything else OS related. The other drive is a 3TB NAS drive used for storage by NextCloud this drive is set to mount under /mnt/nas/ on boot.  

## Networking 

The server has the ip address 192.168.10.62 on the LAN from which it runs. The router port forwards port 22, 80, 443 and 3306 to it. These ports are used for the following: 
```
22 SSH 
80 HTTP (All sites redirect to HTTPS) 
443 HTTPS 
3306 MariaDB   
```
## Domains 
The following domain pointers are needed on the prohousing.no domain
```
intern.prohousing.no A 300 -> 51.174.34.10 
www.intern.prohousing.no A 300 -> 51.174.34.10 
storage.prohousing.no A 300 -> 51.174.34.10 
www.storage.prohousing.no A 300 -> 51.174.34.10 
```

## Apache  

All the web services of the server run on Apache and PHP 5.6 . It has 2 main virtual hosts defined. storage.prohousing.no used for NextCloud, and intern.prohousing.no used for the development version of the Prohousing CRM system.

The document root for storage.prohousing.no is ```/var/www/storage.prohousing.no/html```
<br>and intern.prohousing.no is ```/var/www/intern.prohousing.no/html```

The Apache config files for both sites are located in ```/etc/apache2/sites-available```

If you need to edit php.ini this is located at: ```/etc/php/5.6/apache2/php.ini``` (remember to reload apache after making your changes)

Apache is set to serve both sites over HTTPS using certificates generated by Certbot.

## Certbot(also known as Letsencrypt) 

The server uses Letsencrypt to generate/manage HTTPS certificates. The HTTPS certificates are set to check once every 24 hours if renewal is needed via the Crontab. If this fails, run ```certbot renew```
to check for any potential errors.

## Databases 
The server runs MariaDB version 10.6 . This is used by the two web services on the server 

Here is a list of the databases with a basic explanation.
```
+--------------------+
| Database           |
+--------------------+
| information_schema | Automatic database made by the system
| mysql              | Automatic database made by the system
| nextcloud          | For nextcloud
| performance_schema | Automatic database made by the system
| prohousing_dev     | Used for the dev version of the CRM
| prohousing_portal  | Slave copy of the Production DB of the CRM used for Microsoft Power BI
+--------------------+
```
The prohousing_portal database is a slave server replicant of the production database for the prohousing CRM running on VPS2. Prohousing run Power BI on this server for data analsyis. This is both to circumvent the strict security requirements for Mysql connections on VPS2 for removing some of the 

## NextCloud 
The nextcloud service runs on https://storage.prohousing.no. All files uploaded to NextCloud are stored on the NAS hardrive on the server.
This hardrive is mounted on /mnt/nas.<br>
The files here are backed up every 24 hours on BackBlaze.
Nextcloud stores user info for prohousing on the nextcloud database

## Prohousing CRM 
Runs under the URL: intern.prohousing.no <br>
The CRM system is developed by Taffo in ND Design if there are any runtime related bug with the system contact him
The CRM uses the prohousing_dev database.
## PowerBI
Prohousings employees use Microsoft Power BI for Buisness intellegence. Power BI requires a direct connection to the DB used by their CRM system. 

## Backup
For saving backups the server uses Rclone. Rclone is a FOSS tool with rsync like syntax meant to standardize data transfers between cloud storage services. Rclone synchronises all the files in /mnt/nas/nextcloud to an off-site Backblaze B2 account once every 24 hours. To comply with the strict privacy standards of Prohousing AS this data is encrypted server side with an PEK key.

If you need to retrive an backup from Backblaze the login is in Bubble-